# Claude Usage Report - Quick Reference

## What It Does (Comprehensive)

Claude Usage Report is a dashboard generator that transforms Claude Code's local statistics (`~/.claude/stats-cache.json`) into a beautiful, interactive OLED dark-mode HTML dashboard. It provides deep insights into your Claude AI usage patterns, token consumption, model distribution, daily activity trends, and estimated API costs.

The tool processes Claude Code's session data and generates three output files:
1. **index.html** - Main interactive dashboard with charts and statistics
2. **prompts.html** - Searchable table of all extracted prompts from sessions
3. **data.json** - Raw computed metrics for programmatic access

---

## Installation

### Method 1: Clone the Repository
```bash
git clone https://github.com/nazt/claude-usage-report.git
cd claude-usage-report
```

### Method 2: As a Node.js Script
Copy the `generate.mjs` file to your project directory:
```bash
curl -O https://raw.githubusercontent.com/nazt/claude-usage-report/main/generate.mjs
chmod +x generate.mjs
```

### Requirements
- **Node.js** 18 or higher
- `~/.claude/stats-cache.json` (automatically created by Claude Code)

### Verify Installation
```bash
node --version  # Should be 18+
ls ~/.claude/stats-cache.json  # Should exist if Claude Code has been used
```

---

## Key Features with Examples

### 1. Hero Stats Section
Five key metrics displayed prominently:
- **Total Tokens**: Aggregated across all token types (input, output, cache read, cache creation)
- **Messages**: Total conversations across all sessions
- **Sessions**: Total independent Claude Code sessions
- **Tool Calls**: Total tool invocations (file reads, git commands, etc.)
- **API Estimate**: Estimated cost if tokens were charged per-usage (not actual cost)

Example output: `15B tokens, 420K messages, 5.6K sessions, 64K tool calls, $25,465 estimate`

### 2. Token Breakdown Analysis
Progress bars showing token type distribution:
- **Input (new)**: Fresh prompt tokens sent to Claude
- **Output**: Response tokens generated by Claude
- **Cache Read**: Previously cached tokens reused (low cost)
- **Cache Creation**: New tokens added to cache for future reuse

Example: If output is 77% of total tokens, the bar fills to 77%

### 3. Model Distribution
Bar chart showing which Claude models consumed the most tokens:
- Default: Top 8 models displayed
- Color-coded by model family:
  - Indigo: Claude Opus 4.6
  - Violet: Claude Opus
  - Emerald: Claude Sonnet
  - Amber: Claude Haiku
  - Blue: Gemini (if used)
  - Teal: GPT (if used)
  - Rose: GLM (if used)
  - Orange: Grok (if used)
  - Gray: Other models

Example: "opus-4-5: 15M tokens (95%)"

### 4. Daily Activity Bar Chart
Interactive bar chart showing messages per day across your usage history:
- Each bar represents one day
- Height corresponds to message count
- Top 5 days highlighted in amber
- Hover tooltips show: date, message count, session count
- Scrollable for long histories

Example: 46-day history with peak of 27,751 messages on Jan 21

### 5. Top 5 Busiest Days
Ranked list with badges:
- Day #1 highlighted in amber (peak day)
- Shows date and message count
- Example: "#1 Jan 21 — 27,751 msgs"

### 6. Hourly Activity Distribution
24-hour bar chart showing when you use Claude:
- X-axis: Hours 0-23 (UTC)
- Height: Number of messages sent during that hour
- Helps identify peak productivity hours
- Example: 9-10 AM has 470 messages

### 7. Value Analysis
Cost comparison and savings metric:
- **API Cost (est.)**: What you'd pay on pay-per-token pricing
- **Max Plan**: $200 Claude Pro plan cost
- **Value Multiplier**: How many times the value you're getting
- Cache efficiency stat: "Cache Read = 94% of all tokens — saves most of the cost"

Example: "$25,465 estimated vs $200 plan = 127x value"

---

## Configuration Options

### Command Line Flags

#### Basic Generation
```bash
node generate.mjs
```
Generates three output files in current directory without pushing to git.

#### With Git Push
```bash
node generate.mjs --push
```
Generates files AND automatically commits + pushes to remote repository using git.

### Generated Output Locations

All files are written to the current working directory (project root):
```
.
├── index.html         # Main dashboard (open in browser)
├── prompts.html       # Prompts table with search
├── data.json          # Raw metrics (programmatic access)
└── prompts.json       # Extracted prompts array (programmatic access)
```

### Data Source Configuration

The script automatically reads from:
- **Stats Cache**: `~/.claude/stats-cache.json` (required)
- **Session Index**: `~/.claude/projects/[PROJECT]/sessions-index.json` (for each project)

Both are maintained automatically by Claude Code. No manual configuration needed.

### HTML Customization Points

Edit `generate.mjs` to customize:

#### Pricing Calculation (line 42-43)
```javascript
const costEstimate = (totalInput * 15 + totalOutput * 75 +
  totalCacheRead * 1.5 + totalCacheCreate * 3.75) / 1_000_000;
```
Change multipliers to use different pricing models:
- `15` = Input tokens price per million
- `75` = Output tokens price per million
- `1.5` = Cache read price per million
- `3.75` = Cache creation price per million

#### Model Limit (line 206)
```javascript
const modelRows = models.slice(0, 8).map(m => {
```
Change `8` to display more/fewer models in distribution chart.

#### Top Days Limit (line 56)
```javascript
const topDays = [...daily].sort((a, b) =>
  b.messageCount - a.messageCount).slice(0, 5);
```
Change `5` to show more/fewer top days.

#### Color Scheme (lines 257-275)
Modify Tailwind config colors:
```javascript
colors: {
  primary: '#1E40AF',      // Primary blue
  secondary: '#3B82F6',    // Secondary blue
  accent: '#F59E0B',       // Accent amber
  surface: '#0a0a0f',      // Main background
  'surface-2': '#111118',  // Card background
  'surface-3': '#1a1a24',  // Secondary cards
}
```

---

## How to Generate Reports

### Quick Start (Current Project)
```bash
cd /your/project/directory
node generate.mjs
```

### Generate and Deploy
```bash
node generate.mjs --push
```
This runs:
1. Loads `~/.claude/stats-cache.json`
2. Collects session data from all projects
3. Generates index.html, prompts.html, data.json, prompts.json
4. Commits with message: "update: [lastComputedDate]"
5. Pushes to remote repository

### Viewing Reports
After generation, open the files in your browser:
```bash
open index.html          # Main dashboard
open prompts.html        # Prompts table
```

Or serve via HTTP:
```bash
python3 -m http.server 8000
# Visit http://localhost:8000
```

### Scheduling Automated Reports
Create a cron job to regenerate weekly:
```bash
# Edit crontab
crontab -e

# Add line (runs every Monday at 9 AM):
0 9 * * 1 cd ~/claude-usage-report && node generate.mjs --push
```

---

## How to Customize the Output

### 1. Modify Model Coloring
Edit `modelColor()` function (lines 161-171) to change colors per model:
```javascript
function modelColor(id) {
  if (id.includes('opus-4-6')) return { bg: 'indigo', hex: '#6366f1' };
  if (id.includes('opus')) return { bg: 'violet', hex: '#8b5cf6' };
  // Add custom colors:
  if (id.includes('mymodel')) return { bg: 'pink', hex: '#ec4899' };
  return { bg: 'gray', hex: '#6b7280' };
}
```

### 2. Adjust Number Formatting
Edit `fmt()` function (lines 146-151) to change display precision:
```javascript
function fmt(n) {
  if (n >= 1e9) return (n / 1e9).toFixed(3) + 'B';  // More decimals
  if (n >= 1e6) return (n / 1e6).toFixed(2) + 'M';  // Fewer decimals
  if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
  return n.toString();
}
```

### 3. Filter Sessions by Project
Modify `loadAllSessions()` (lines 117-132) to include only specific projects:
```javascript
function loadAllSessions() {
  const all = [];
  if (!existsSync(PROJECTS_DIR)) return all;
  for (const dir of readdirSync(PROJECTS_DIR)) {
    // Skip certain projects:
    if (dir.includes('archive')) continue;
    if (dir.includes('test')) continue;
    // ... rest of function
  }
}
```

### 4. Customize HTML Layout
Edit `generateHTML()` function (lines 186-466) to rearrange sections or change styling:
- Move hero stats with `<!-- Hero Stats -->` block
- Reorder grid sections with `<!-- Main Grid -->`, `<!-- Bottom Grid -->`
- Change responsive breakpoints: `grid-cols-2 lg:grid-cols-5` means 2 on mobile, 5 on desktop

### 5. Add Custom Sections
Insert new sections in HTML template. Example: Add a "Session Duration" chart:
```javascript
// Add after model distribution, before daily chart
const sessionHtml = `<div class="glass rounded-2xl p-6">
  <h2 class="text-lg font-semibold mb-6">Session Durations</h2>
  <!-- Your custom content -->
</div>`;
```

### 6. Extract Data for External Use
Use `data.json` output in other applications:
```bash
# Parse with jq
jq '.models[] | select(.id | contains("opus"))' data.json

# Use in custom scripts
node -e "const d = require('./data.json'); console.log(d.costEstimate)"
```

### 7. Change Time Range
Modify `stats.firstSessionDate` filter to show custom date ranges. Example: Last 30 days only:
```javascript
const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
const filtered = daily.filter(d => new Date(d.date) > thirtyDaysAgo);
```

---

## Data Structure Reference

### Input: stats-cache.json
```json
{
  "totalSessions": 5612,
  "totalMessages": 420495,
  "lastComputedDate": "2026-02-06",
  "firstSessionDate": "2025-12-05",
  "modelUsage": {
    "claude-opus-4-5-20251101": {
      "inputTokens": 4604493,
      "outputTokens": 10104397,
      "cacheReadInputTokens": 13469407056,
      "cacheCreationInputTokens": 788912720
    }
  },
  "dailyActivity": [
    {
      "date": "2025-12-05",
      "messageCount": 1453,
      "sessionCount": 1,
      "toolCallCount": 444
    }
  ],
  "hourCounts": {
    "0": 164,
    "9": 457,
    "23": 191
  }
}
```

### Output: data.json
```json
{
  "generated": "2026-02-06T05:58:20.201Z",
  "totalTokens": 15027925074,
  "costEstimate": 25465.22,
  "models": [
    {
      "id": "claude-opus-4-5-20251101",
      "total": 14273028666,
      "input": 4604493,
      "output": 10104397,
      "cacheRead": 13469407056,
      "cacheCreate": 788912720
    }
  ]
}
```

---

## Pricing Model

Claude Usage Report uses Opus pricing for cost estimates (Opus handles highest token volumes). Update in code if needed:

| Token Type | Price | Variable |
|------------|-------|----------|
| Input (new) | $15/M | `15` |
| Output | $75/M | `75` |
| Cache Read | $1.50/M | `1.5` |
| Cache Creation | $3.75/M | `3.75` |

**Note**: This is an estimate. Actual billing may differ based on your plan (Pro, Team, API) and current pricing. Check https://www.anthropic.com/pricing for current rates.

---

## Troubleshooting

### Error: "Cannot find module 'fs'"
Node.js not installed or wrong version. Install Node 18+:
```bash
# Check version
node --version

# Update if needed:
brew install node  # macOS
# or download from nodejs.org
```

### Error: "stats-cache.json not found"
Claude Code hasn't been used yet. Use Claude Code for at least one session, then run:
```bash
ls ~/.claude/stats-cache.json
node generate.mjs
```

### Empty prompts.html
Sessions don't have `firstPrompt` data. This is normal for very new installations. More sessions = more prompt data.

### Git push fails with "--push"
Ensure you're in a git repository:
```bash
git init
git add -A
git commit -m "initial"
git remote add origin <your-repo-url>
node generate.mjs --push
```

### Large file sizes
The HTML includes Tailwind CDN (inline CSS). To reduce size:
- Host Tailwind locally instead of CDN
- Minify the output HTML
- Use gzip compression on server

---

## API Reference for Developers

### extract_daily_metrics(stats)
Returns array of daily activity objects:
```javascript
[
  { date: "2025-12-05", messageCount: 1453, sessionCount: 1, toolCallCount: 444 },
  // ... more days
]
```

### calculate_token_cost(input, output, cacheRead, cacheCreate)
Returns estimated cost in USD:
```javascript
const cost = (input * 15 + output * 75 + cacheRead * 1.5 + cacheCreate * 3.75) / 1_000_000;
```

### formatNumber(n)
Abbreviates large numbers with suffix:
```
fmt(15027925074) => "15.03B"
fmt(5239897) => "5.24M"
fmt(64790) => "64.8K"
```

---

## Live Demo

View a sample report: [nazt.github.io/claude-usage-report](https://nazt.github.io/claude-usage-report/)

---

## License

MIT - Free to use and modify

---

## Repository

- **GitHub**: https://github.com/nazt/claude-usage-report
- **Project**: OLED dark-mode Claude Code usage dashboard
- **Maintainer**: nazt
